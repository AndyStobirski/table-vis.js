"use strict";var d3=require("d3");const rowBase=e=>{if("object"==typeof e)return Array.from(e.children);console.error("the cell bind doesn't come from DOM ")},colBase=e=>{if("object"==typeof e)return e.children;console.error("the cell bind doesn't come from DOM ")},base=(e,t)=>{let a;return"row"==t?a=rowBase(e):"col"==t?a=colBase(e):void console.error("please type row or col as direction")},baseStyle=e=>{let t=e.createLinearGradient(0,200,0,0);t.addColorStop(0,"rgba(110,200,245,1)"),t.addColorStop(1,"rgba(40,125,250,1)");let a=e.createLinearGradient(0,200,0,0);return a.addColorStop(0,"rgba(135,135,135,1)"),a.addColorStop(1,"rgba(0,60,60,1)"),[t,a]},drawBarLine=(e,t,a,r,l)=>{e.beginPath(),e.moveTo(t,a),e.lineTo(r,l),e.stroke(),e.closePath()},drawBarMark=(e,t,a,r)=>{e.strokeStyle="black";let l=parseInt(t/a);e.textAlign="right";for(let n=0;n<=a;n+=2){let a=n*l,o=parseInt(r*(1-a/t));e.fillText(a,0,o)}},drawBar=(e,t)=>{e=e.map(e=>parseInt(e,10));let a=.2*document.body.clientWidth+15,r=d3.select(".tabular").append("canvas").attr("width",a).attr("height",200).style("animation","canvas_key 1s").style("WebkitAnimation","canvas_key 1s").node().getContext("2d");r.translate(15,0);let l=5,n=5;drawBarLine(r,0,195,a,195),drawBarLine(r,0,195,0,0),drawBarMark(r,d3.max(e),e.length,200);let o=d3.scaleLinear().range([0,a-l-n]).domain([0,d3.max(e)]),s=baseStyle(r);e.forEach(function(l,n){r.beginPath(),r.rect(a/e.length*n*.95,195,a/e.length*.8,-o(l)),n==t?(r.fillStyle=s[0],r.strokeStyle=s[0]):(r.fillStyle=s[1],r.strokeStyle=s[1]),r.fill(),r.closePath()})},insertCss=()=>{let e="".concat("@keyframes tabular{ from{ width:0px} to { width:20%} }\n","@keyframes canvas_key{ from{ height:0} to { height:100%} }\n","@-webkit-keyframes canvas_key{ from{ height:0} to { height:100%} }\n",".tabular_container{position:fixed;height:200px;background:rgba(255,255,255,0.5)}\n",".tabular{position:relative;width:100%;height:100%;}\n"),t=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e)),t.appendChild(a),console.log("Insert Css done")},className={addClass:function(e,t){let a=e.className,r=a+(""==a?"":" ")+t;e.className=r},removeClass:function(e,t){let a=" "+e.className+" ",r=(a=a.replace(/(\s+)/gi," ")).replace(" "+t+" "," ");removedSpace=r.replace(/(^\s+)|(\s+$)/g,""),e.className=removedSpace}},createTabular=()=>{let e=document.createElement("div"),t=document.createElement("div");return className.addClass(t,"tabular"),className.addClass(e,"tabular_container"),e.appendChild(t),document.body.appendChild(e),e},swapTabularVis=(e,t,a,r)=>{if(e){t.removeAttribute("style");let e=t.firstElementChild;return e.removeChild(e.firstElementChild),!1}return t.style.top=r+"px",t.style.left=a+"px",t.style.width=.2*document.body.clientWidth+"px",t.style.animation="tabular 1s",t.style.WebkitAnimation="tabular 1s",!0},bar=(e,t)=>{let a=base(e,t),r=[],l=!1;insertCss();let n=createTabular();for(let e=0;e<a.length;e++){r.push(a[e].innerHTML);let t=Array.prototype.indexOf.call(a,a[e]);a[e].style.cursor="pointer",a[e].addEventListener("click",e=>{let a=e||window.event;(l=swapTabularVis(l,n,a.clientX,a.clientY))&&drawBar(r,t)},!0)}},tabular_vis={bar:bar};module.exports=tabular_vis;
