"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var fontawesome=_interopDefault(require("@fortawesome/fontawesome")),faChartBar=_interopDefault(require("@fortawesome/fontawesome-free-solid/faChartBar")),faChartPie=_interopDefault(require("@fortawesome/fontawesome-free-solid/faChartPie")),faChartLine=_interopDefault(require("@fortawesome/fontawesome-free-solid/faChartLine")),faColumns=_interopDefault(require("@fortawesome/fontawesome-free-solid/faColumns")),faBraille=_interopDefault(require("@fortawesome/fontawesome-free-solid/faBraille")),faFileWord=_interopDefault(require("@fortawesome/fontawesome-free-solid/faFileWord")),d3a=require("d3-array"),d3s=require("d3-selection"),d3sc=require("d3-scale"),cloud=_interopDefault(require("d3-cloud"));function styleInject(e,t){void 0===t&&(t={});var a=t.insertAt;if(e&&"undefined"!=typeof document){var l=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===a&&l.firstChild?l.insertBefore(n,l.firstChild):l.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}var css="/*tbody*/\n.tab_vis_tbody{\n  cursor: pointer;\n}\n\n/* row & column button components set */\n.tab_vis_btn_container{\n  cursor: pointer;\n  position: fixed;\n  width:60px;\n  height: 40px;\n  display: none;\n  box-shadow: 2px 2px 2px grey;\n}\n.tab_vis_btn{\n  position: relative;\n  width: 100%;\n  height: 100%;\n  background-color: #fff;\n  border: 1px solid #c1c1c1;\n  border-radius: 3px;\n}\n/* the triangle arrow */\n.tab_vis_btn:before,.tab_vis_btn:after{\n  content: ' ';\n  width: 0;\n  height: 0;\n  position: absolute;\n  top:4px;\n  left:-12px;\n  border: 6px solid transparent;\n  border-right-color:#fff;\n}\n.tab_vis_btn:before{\n  left:-13px;\n  border-right-color: #c1c1c1;\n}\n.tab_vis_btn div{\n  text-align: center;\n  height: 20px;\n  color:#777;\n  border-bottom:1px solid #d3d3d3;\n}\n.tab_vis_btn div:hover{\n  text-align: center;\n  height: 20px;\n  background: #d3d3d3;\n}\n";styleInject(css);const className={addClass:function(e,t){let a=e.className,l=a+(""==a?"":" ")+t;return e.className=l,e},removeClass:function(e,t){let a=" "+e.className+" ",l=(a=a.replace(/(\s+)/gi," ")).replace(" "+t+" "," ").replace(/(^\s+)|(\s+$)/g,"");return e.className=l,e}};var css$1="\n@keyframes canvaKey{\n  0% { opacity:0; }\n  25% { opacity:0.3; }\n  50% { opacity:0.5;}\n  100% {opacity:1; }}\n@-webkit-keyframes canvasKey{\n  0% { opacity:0; }\n  25% { opacity:0.3; }\n  50% { opacity:0.5;}\n  100% {opacity:1; }}\n/*highlight the data cells*/\n@keyframes  td_highlight {\n   from { background: #fff;}\n   to { background: rgba(110,200,245,1)}\n}\n@-webkit-keyframes  td_highlight {\n   from { background: #fff;}\n   to { background: rgba(110,200,245,1)}\n}\n.tabular_container_fluid{\n  display:inline-block;\n  position:fixed;\n  margin:auto;\n  top:0;\n  left:0;\n  bottom:0;\n  right:0;\n  width:0;\n  height:0;\n  background:rgba(255,255,255,0.9);\n}\n.tabular_container_fluid .tabular_container{\n  margin:0px auto;\n  text-align: center;\n}\n.tabular_container_fluid .tabular_container canvas{\n    zoom:0.5;\n}\n.tabular_container_fluid #tabular_vis_btn{\n  margin:0px auto;\n  text-align: center;\n  height: 10%;\n  width: 100%;\n  margin-bottom:10px;\n  overflow: hidden;\n}\n.table_no_display{\n  display: none!important;\n}\n.tabular_container_fluid h3\n{\n  text-align: center;\n}\n.tabular_highlight{\n  animation: td_highlight 1s infinite reverse;\n  -webkit-animation: td_highlight 1s infinite reverse;\n\n}\n";styleInject(css$1);const insertCss=()=>{fontawesome.library.add(faChartBar),fontawesome.library.add(faChartPie),fontawesome.library.add(faChartLine),fontawesome.library.add(faColumns),fontawesome.library.add(faBraille),fontawesome.library.add(faFileWord),console.log("Insert Tabluar-vis Css done!")},canvasBase={setCanvas:function(e,t,a){return d3s.select(".tabular_container").append("canvas").attr("width",e).attr("height",t).style("animation","canvasKey 1s").style("WebkitAnimation","canvasKey 1s")},setScale:function(e,t){return d3sc.scaleLinear().range([0,e-20]).domain([0,d3a.max(t)])},setPieScale:function(e){return d3sc.scaleLinear().range([0,2*Math.PI]).domain([0,e])},maxData:function(e){return d3a.max(e)}},barStyle=e=>{let t=e.createLinearGradient(0,200,0,0);t.addColorStop(0,"rgba(110,200,245,1)"),t.addColorStop(1,"rgba(40,125,250,1)");let a=e.createLinearGradient(0,200,0,0);return a.addColorStop(0,"rgba(135,135,135,1)"),a.addColorStop(1,"rgba(0,60,60,1)"),[t,a]},drawBarLine=(e,t,a,l,n)=>(e.beginPath(),e.moveTo(t,a),e.lineTo(l,n),e.closePath(),e.stroke(),e),drawBarMark=(e,t,a,l,n,r,i)=>{let o=e.getContext("2d");o.strokeStyle="black";let d=2*parseInt(t/a);0==d&&(d=.5),o.textAlign="right";let s=0,c=n;for(o.fillText(0,0,c);s<t;){let e=s+d,t=n-r(e);o.moveTo(5,t),o.lineTo(l,t),o.strokeStyle="rgba(135,135,135,0.5)",o.stroke(),o.fillText(e,0,t,15),s+=d}},drawBarRect=(e,t,a,l,n,r,i,o,d,s)=>{let c=l/a.length*.8,u=l/a.length*.98;e.font="14px Arial",a.forEach(function(a,l){e.beginPath(),e.rect(u*l+10,n-20,c,-r(a)),l==o&&void 0==s||void 0!=s&&s[l].includes(o)?(e.fillStyle=i[0],e.strokeStyle=i[0]):(e.fillStyle=i[1],e.strokeStyle=i[1]),e.fill(),e.closePath(),e.beginPath(),e.fillStyle="rgba(0,0,0,1)",e.textAlign="center",e.fillText(d[l],u*l+10+c/2,n,c),e.fillStyle="rgba(255,255,255,1)";let f=t.length>0?t[l]:a;e.fillText(f,u*l+10+c/2,n-r(a),c)})},drawBar=(e,t,a,l,n,r)=>{t=t.map(e=>parseFloat(e,10));let i=document.querySelector(".tabular_container");i.firstElementChild&&i.removeChild(i.firstElementChild);let o=canvasBase.setCanvas(740,740,l),d=o.node().getContext("2d"),s=canvasBase.setScale(710,t),c=canvasBase.maxData(t);d.translate(15,0),drawBarLine(d,5,720,740,720),drawBarLine(d,5,720,5,0),drawBarMark(o.node(),c,t.length,740,720,s);let u=barStyle(d);return drawBarRect(d,e,t,740,740,s,u,a,n,r),d.scale(2,2),i},bar=function(e,t,a,l,n,r){drawBar(e,t,a,l,n,r)},drawPieText=(e,t,a,l,n,r,i,o)=>{e.fillStyle="rgba(0,0,0,1)",e.font="20px Arial";let d=parseFloat(i/o),s=(d=Number(100*d).toFixed(2))+"%",c=(100-d).toFixed(2)+"%";e.fillText(s,t,a),e.fillText(c,l,n)},drawPieCircle=(e,t,a,l,n,r,i,o)=>{let d={x:.5*a,y:.5*l,radius:a<l?.3*a:.3*l,focusCircle:n(t[o])};e.beginPath(),e.moveTo(d.x,d.y),e.arc(d.x,d.y,d.radius,0,d.focusCircle);let s=d.focusCircle/2,c={x:d.x+d.radius*Math.cos(s),y:d.y+d.radius*Math.sin(s)};c.x=c.x<d.x?c.x-30:c.x+30,c.y=c.y<d.y?c.y-30:c.y+30,e.fillStyle=i[0],e.strokeStyle=i[0],e.closePath(),e.fill(),e.moveTo(d.x,d.y),e.lineTo(c.x,c.y),e.stroke(),e.beginPath(),e.moveTo(d.x,d.y),e.arc(d.x,d.y,d.radius,d.focusCircle,2*Math.PI);let u=(d.focusCircle+2*Math.PI)/2,f={x:d.x+d.radius*Math.cos(u),y:d.y+d.radius*Math.sin(u)};f.x=f.x<d.x?f.x-60:f.x+30,f.y=f.y<d.y?f.y-60:f.y+30,e.strokeStyle=i[1],e.fillStyle=i[1],e.closePath(),e.fill(),e.moveTo(d.x,d.y),e.lineTo(f.x,f.y),e.stroke(),drawPieText(e,c.x,c.y,f.x,f.y,0,t[o],r)},drawPieRect=(e,t,a)=>{let l=.1*a,n="except ".concat(t);e.beginPath(),e.fillStyle="rgba(110,200,245,1)",e.rect(l,l,.5*l,.3*l),e.fillText(t,1.6*l,l+16),e.fill(),e.beginPath(),e.fillStyle="rgba(135,135,135,1)",e.rect(l,1.5*l,.5*l,.3*l),e.fillText(n,1.6*l,1.5*l+16),e.fill()},pieStyle=e=>{let t=e.createLinearGradient(0,200,0,0);t.addColorStop(0,"rgba(110,200,245,1)"),t.addColorStop(1,"rgba(40,125,250,1)");let a=e.createLinearGradient(0,200,0,0);return a.addColorStop(0,"rgba(135,135,135,1)"),a.addColorStop(1,"rgba(0,60,60,1)"),[t,a]},drawPie=(e,t,a,l)=>{let n=0;e=e.map(e=>{if(!isNaN(parseFloat(e,10)))return n+=parseFloat(e,10),parseFloat(e,10)});let r=document.querySelector(".tabular_container");r.firstElementChild&&r.removeChild(r.firstElementChild);let i=canvasBase.setCanvas(740,740).node().getContext("2d"),o=canvasBase.setPieScale(n);i.translate(15,0);let d=pieStyle(i);if(void 0!=l){let r;for(let e=0;e<l.length;e++)l[e].includes(t)&&(r=e);drawPieCircle(i,e,740,740,o,n,d,r),drawPieRect(i,a[r],740)}else drawPieCircle(i,e,740,740,o,n,d,t),drawPieRect(i,a[t],740);i.scale(2,2)},pie=function(e,t,a,l){drawPie(e,t,a,l)},drawLinePath=(e,t,a,l,n,r,i,o,d,s)=>{let c=l/a.length*.98;e.font="14px Arial",e.lineWidth="4",a.forEach((l,u)=>{e.beginPath(),u!=a.length-1&&(e.moveTo(c*u+20,n-15-r(l)),e.lineTo(c*(u+1)+20,n-15-r(a[u+1])),e.strokeStyle=i[1]),e.closePath(),e.stroke(),e.beginPath(),u==o&&void 0==s||void 0!=s&&s[u].includes(o)?(e.font="22px Arial",e.fillStyle=i[0]):e.fillStyle=i[1];let f=t.length>0?t[u]:l;e.fillText(f,c*u+c/2,n-r(l)-20),e.closePath(),e.fill(),e.fillStyle=i[1],e.textAlign="center",e.font="14px Arial",e.fillText(d[u],c*u+c/2,n,c)})},lineStyle=()=>{return["rgba(40,125,250,1)","rgba(135,135,135,1)"]},drawLine=(e,t,a,l,n,r)=>{t=t.map(e=>parseFloat(e,10));let i=document.querySelector(".tabular_container");i.firstElementChild&&i.removeChild(i.firstElementChild);let o=canvasBase.setCanvas(740,740,l),d=o.node().getContext("2d"),s=canvasBase.setScale(710,t),c=canvasBase.maxData(t);return d.translate(15,0),drawBarLine(d,5,720,740,720),drawBarLine(d,5,720,5,0),drawBarMark(o.node(),c,t.length,740,720,s),drawLinePath(d,e,t,740,740,s,["rgba(40,125,250,1)","rgba(135,135,135,1)"],a,n,r),d.scale(2,2),d},line=(e,t,a,l,n,r)=>{drawLine(e,t,a,l,n,r)},drawBox=(e,t,a,l,n,r,i,o,d)=>{e.beginPath(),e.strokeStyle="#000000",e.fillStyle="#000000",e.font="20px Arial";let s=n-r(o.max)-10,c=n-r(o.min)-10,u=n-r(o.middle)-10,f=n-r(o.q3)-10,h=r(o.q3-o.q1);e.moveTo(.4*l,s),e.lineTo(.5*l,s),e.fillText("Max",.7*l,s),e.moveTo(.4*l,c),e.lineTo(.5*l,c),e.fillText("Min",.7*l,c),e.moveTo(.45*l,s),e.lineTo(.45*l,c),e.stroke(),e.beginPath(),e.strokeStyle="#000",e.fillStyle="#FFF",e.fillRect(.3*l,f,.3*l,h),e.strokeRect(.3*l,f,.3*l,h),e.stroke(),e.beginPath(),e.fillStyle="#000",e.moveTo(.3*l,u),e.lineTo(.6*l,u),e.fillText("Middle",.8*l,u),e.stroke(),e.beginPath(),e.strokeStyle="#108AEC",e.fillStyle="#108AEC";let m=n-r(a[i])-10;e.arc(.5*l,m,10,0,2*Math.PI),e.font="20px Arial",e.fillText(t[i],.2*l,m),e.fill()},drawBoxPlot=(e,t,a,l,n,r)=>{t=t.map(e=>parseFloat(e,10));let i=document.querySelector(".tabular_container");i.firstElementChild&&i.removeChild(i.firstElementChild);let o=canvasBase.setCanvas(740,740,n),d=o.node().getContext("2d"),s=canvasBase.setScale(710,t),c=canvasBase.maxData(t);d.translate(15,0),drawBarLine(d,5,720,5,0),drawBarMark(o.node(),c,t.length,740,720,s),drawBox(d,e,t,740,740,s,a,l),d.scale(2,2)},quickSort=e=>{if((e=e.map(e=>parseFloat(e,10))).length<=1)return e;{let t=Math.floor(e.length/2)-1,a=e.splice(t,1)[0],l=[],n=[];for(let t=0;t<e.length;t++)e[t]<a?l.push(e[t]):n.push(e[t]);return quickSort(l).concat([a],quickSort(n))}},calcPlot=function(e){let t=e;t=quickSort(t);let a,l,n,r=e.length,i=Math.floor(t.length/2);a=t.length%2!=0?t[i]:(t[i-1]+t[i])/2,n=(1+r)/4;let o=parseInt(n),d=o+1-n,s=d*t[o-1]+(1-d)*t[o];l=3*n;let c=parseInt(l),u=parseInt(l)+1-l,f=u*t[c-1]+(1-u)*t[c],h=f-s,m=s-1.5*h,p=f+1.5*h;return t[0]>m&&(m=t[0]),t[t.length-1]<p&&(p=t[t.length-1]),{min:m,max:p,middle:a,q3:f,q1:s}},boxPlot=function(e,t,a,l,n){let r=calcPlot(t);drawBoxPlot(e,t,a,r,l)},pointStyle=e=>{let t=e.createLinearGradient(0,200,0,0);t.addColorStop(0,"rgba(110,200,245,1)"),t.addColorStop(1,"rgba(40,125,250,1)");let a=e.createLinearGradient(0,200,0,0);return a.addColorStop(0,"rgba(135,135,135,1)"),a.addColorStop(1,"rgba(0,60,60,1)"),[t,a]},drawPointCol=(e,t,a,l,n,r,i,o,d,s)=>{let c=l/a.length*.05,u=l/a.length*.9;a.forEach((a,l)=>{e.beginPath(),e.arc(u*(l+1)+c/2,n-r(a),4*c,0,2*Math.PI),e.rect(u*(l+1),n,c,-r(a)+4*c),console.log(s),l==o&&void 0==s||void 0!=s&&s[l].includes(o)?(e.fillStyle=i[0],e.strokeStyle=i[0]):(e.fillStyle=i[1],e.strokeStyle=i[1]),e.fill(),e.closePath(),e.beginPath(),e.fillStyle="rgba(0,0,0,1)",e.textAlign="center",e.fillText(d[l],u*(l+1)+c/2,n+20,25),e.fillStyle="rgba(255,255,255,1)";let f=t.length>0?t[l]:a;e.fillText(f,u*(l+1)+c/2,n-r(a)+c,25)})},drawPoint=(e,t,a,l,n,r)=>{t=t.map(e=>parseFloat(e,10));let i=document.querySelector(".tabular_container");i.firstElementChild&&i.removeChild(i.firstElementChild);let o=canvasBase.setCanvas(740,740,l),d=o.node().getContext("2d"),s=canvasBase.setScale(710,t),c=canvasBase.maxData(t);d.translate(15,0),drawBarLine(d,5,720,740,720),drawBarLine(d,5,720,5,0),drawBarMark(o.node(),c,t.length,740,720,s);let u=pointStyle(d);drawPointCol(d,e,t,740,720,s,u,a,n,r),d.scale(2,2)},point=function(e,t,a,l,n,r){drawPoint(e,t,a,l,n,r)},drawWordCloud=(e,t,a,l)=>{let n=document.querySelector(".tabular_container");n.firstElementChild&&n.removeChild(n.firstElementChild);let r=canvasBase.setScale(100,e),i=cloud().size([400,400]).words(a.map(function(a,n){return l[n].includes(t)?{text:a,size:r(e[n]),color:"rgba(40,125,250,1)"}:{text:a,size:r(e[n]),color:"#000"}})).padding(5).font("Impact").fontSize(function(e){return e.size}).on("end",function(e){d3s.select(".tabular_container").append("svg").attr("width",i.size()[0]).attr("height",i.size()[1]).append("g").attr("transform","translate("+i.size()[0]/2+","+i.size()[1]/2+")").selectAll("text").data(e).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("fill",function(e){return e.color}).style("font-family","Impact").attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+")"}).text(function(e){return e.text})});i.start()},wordCloud=(e,t,a,l)=>{drawWordCloud(e,t,a,l)},createIcon=()=>{let e=document.createElement("i");className.addClass(e,"fa fa-chart-bar");let t=document.createElement("i");className.addClass(t,"fa fa-chart-pie");let a=document.createElement("i");className.addClass(a,"fa fa-chart-line");let l=document.createElement("i");className.addClass(l,"fas fa-columns");let n=document.createElement("i");className.addClass(n,"fas fa-braille");let r=document.createElement("i");return className.addClass(r,"fas fa-file-word"),[e,t,a,l,n,r]},createDrawButton=e=>{let t=e.data,a=document.createElement("div");a.setAttribute("id","tabular_vis_btn");let l=createIcon(),n=document.createElement("button");n.appendChild(l[0]),n.addEventListener("click",()=>{let e=[t.oriData,t.data,t.index,t.status,t.title,t.titleIdx];bar(...e)}),a.appendChild(n);let r=document.createElement("button"),i=document.createElement("i");className.addClass(i,"fa fa-chart-pie"),r.appendChild(l[1]),r.addEventListener("click",()=>{let e=[t.data,t.index,t.title,t.titleIdx];pie(...e)}),a.appendChild(r);let o=document.createElement("button");className.addClass(o,"numerical"),o.appendChild(l[2]),o.addEventListener("click",()=>{let e=[t.oriData,t.data,t.index,t.status,t.title,t.titleIdx];line(...e)}),a.appendChild(o);let d=document.createElement("button");className.addClass(d,"numerical"),d.appendChild(l[3]),d.addEventListener("click",()=>{let e=[t.oriData,t.data,t.index,t.status,t.title];boxPlot(...e)}),a.appendChild(d);let s=document.createElement("button");s.appendChild(l[4]),className.addClass(s,"numerical"),s.addEventListener("click",()=>{let e=[t.oriData,t.data,t.index,t.status,t.title,t.titleIdx];point(...e)}),a.appendChild(s);let c=document.createElement("button");return className.addClass(c,"cate"),c.appendChild(l[5]),c.addEventListener("click",()=>{let e=[t.data,t.index,t.title,t.titleIdx];wordCloud(...e)}),a.appendChild(c),a},createTableVisContainer=e=>{let t=document.createElement("div");className.addClass(t,"tabular_container_fluid");let a=document.createElement("div");return a.setAttribute("id","tabular_vis"),className.addClass(a,"tabular_container"),a.addEventListener("click",()=>{t.removeAttribute("style"),t.style.width="0",t.removeChild(t.querySelector("h3")),a.removeChild(a.firstElementChild),document.querySelectorAll(".tabular_highlight").forEach(e=>{className.removeClass(e,"tabular_highlight")})}),t.appendChild(createDrawButton(e)),t.appendChild(a),document.body.appendChild(t),console.log("Create Tabular div done"),t},swapTableVis=(e,t)=>{let a=t.querySelector(".tabular_container");return e?"0px"!=t.style.width?(t.removeAttribute("style"),t.style.width="0",t.removeChild(t.firstElementChild),!1):(t.style.width="400px",t.style.height="500px",t.style.animation="tabular 1s",t.style.WebkitAnimation="tabular 1s",t.style.cursor="pointer",!0):(a.firstElementChild&&a.removeChild(a.firstElementChild),t.style.width="400px",t.style.height="500px",t.style.animation="tabular 1s",t.style.WebkitAnimation="tabular 1s",t.style.cursor="pointer",!0)},numericalData=(e,t,a,l)=>{for(let n=0;n<e[0].length;){let r=e[0][n].innerHTML,i=r.replace(/\,|\%/g,"");if(/^\d+\/\d+$/.test(i)){let e=i.split("/");i=e[0]/e[0]}l.push(r),t.push(i),a.push(e[1][n].innerHTML),n++}return{oriData:l,data:t,title:a}},cateData=(e,t,a,l)=>{let n=[];for(let l=0;l<e.length;l++){let r=e[l].innerHTML;if(a.includes(r)){let e=a.indexOf(r);n[e].push(l),t[e]++}else t.push(1),a.push(r),n.push([l])}return{oriData:l,data:t,title:a,titleIdx:n}},regData=(e,t)=>{let a=[],l=[],n=[],r=e[0][0].innerHTML.replace(/\,/g,"");return t&&e[0].forEach(e=>{className.addClass(e,"tabular_highlight")}),/^\d+\.?\d*$/.test(r)||/^\d+\.?\d+\%$/.test(r)||/^\d+\/\d+$/.test(r)?numericalData(e,a,l,n):cateData(e[0],a,l,n)},colData=function(e,t,a){let l=e.parentNode,n=l.parentNode.children,r=[],i=Array.prototype.indexOf.call(l.children,e);for(let e=0;e<n.length;e++)r.push(n[e].children[i]);let o=regData([r,t],a),d={data:o.data,oriData:o.oriData,title:o.title,index:Array.prototype.indexOf.call(r,e)};return"titleIdx"in o&&Object.assign(d,{titleIdx:o.titleIdx}),d},rowData=function(e,t,a){let l=e.parentNode,n=Array.from(l.children);n.shift();let r=regData([n,t],a),i={data:r.data,title:r.title,oriData:r.oriData,index:Array.prototype.indexOf.call(n,e)};return"titleIdx"in r&&Object.assign(i,{titleIdx:r.titleIdx}),i},initHead=(e,t)=>{if(e.querySelector("h3"))return e.querySelector("h3").innerHTML=t,e.querySelector("h3");{let e=document.createElement("h3");return e.innerHTML=t,e}},initBtn=(e,t)=>{let a=document.createElement("div"),l=document.createElement("div");className.addClass(a,"tab_vis_btn_container"),className.addClass(l,"tab_vis_btn");let n=document.createElement("div"),r=document.createElement("div");n.innerHTML="ROW",r.innerHTML="COL";return l.appendChild(n),l.appendChild(r),a.appendChild(l),document.body.appendChild(a),n.addEventListener("click",()=>{document.querySelectorAll(".tabular_highlight").forEach(function(e){className.removeClass(e,"tabular_highlight")}),a.style.display="none";let l=rowData(e.ele,e.rowTitle,1),n=colData(e.ele,e.colTitle,0).index;Object.assign(e.data,{data:l.data,title:l.title,index:l.index,oriData:l.oriData,head:e.colTitle[n].innerHTML,status:"row"}),"titleIdx"in l?Object.assign(e.data,{titleIdx:l.titleIdx}):"titleIdx"in e.data&&delete e.data.titleIdx,t.insertBefore(initHead(t,e.data.head),t.querySelector(".tabular_container")),document.querySelectorAll(".table_no_display").forEach(e=>className.removeClass(e,"table_no_display")),l.oriData.length>0?document.querySelectorAll(".cate").forEach(e=>className.addClass(e,"table_no_display")):document.querySelectorAll(".numerical").forEach(e=>className.addClass(e,"table_no_display")),swapTableVis(!1,t),bar(l.oriData,l.data,l.index,"row",l.title,l.titleIdx)}),r.addEventListener("click",()=>{document.querySelectorAll(".tabular_highlight").forEach(e=>{className.removeClass(e,"tabular_highlight")}),a.style.display="none";let l=colData(e.ele,e.colTitle,1),n=rowData(e.ele,e.rowTitle,0).index;Object.assign(e.data,{data:l.data,title:l.title,index:l.index,oriData:l.oriData,head:e.rowTitle[n].innerHTML,status:"col"}),"titleIdx"in l?Object.assign(e.data,{titleIdx:l.titleIdx}):"titleIdx"in e.data&&delete e.data.titleIdx,t.insertBefore(initHead(t,e.data.head),t.querySelector(".tabular_container")),document.querySelectorAll(".table_no_display").forEach(e=>className.removeClass(e,"table_no_display")),l.oriData.length>0?document.querySelectorAll(".cate").forEach(e=>className.addClass(e,"table_no_display")):document.querySelectorAll(".numerical").forEach(e=>className.addClass(e,"table_no_display")),swapTableVis(!1,t),swapTableVis(!1,t),bar(l.oriData,l.data,l.index,"col",l.title,l.titleIdx)}),a},colTitle=e=>{let t=e.querySelector("tbody").children,a=[];for(let e=0;e<t.length;e++)a.push(t[e].children[0]);return a},rowTitle=e=>{let t=e.querySelector("thead").querySelector("tr");return t=Array.from(t.children),Array.prototype.shift.call(t),t},tableElement="[object HTMLTableElement]",initTableVis=function(e){if(Object.prototype.toString.call(e)==tableElement){let t,a=e.querySelector("tbody"),l=new Object;this.initial?t=document.querySelector(".tabular_container_fluid"):(Object.assign(l,{data:{},rowTitle:rowTitle(e),colTitle:colTitle(e)}),fontawesome.library.add(faChartBar),fontawesome.library.add(faChartPie),fontawesome.library.add(faChartLine),fontawesome.library.add(faColumns),fontawesome.library.add(faBraille),fontawesome.library.add(faFileWord),console.log("Insert Tabluar-vis Css done!"),t=createTableVisContainer(l),this.initial=!0);let n=initBtn(l,t);className.addClass(a,"tab_vis_tbody"),a.addEventListener("click",e=>{let t=e||window.event,a=t.clientX,r=t.clientY;n.style.left=a+"px",n.style.top=r+"px",n.style.display="block",l.ele=t.target})}else console.error("Please ensure the table element is use")},table_vis={initial:!1,vis:initTableVis};module.exports=table_vis;
