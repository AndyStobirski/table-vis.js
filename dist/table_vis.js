"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var fontawesome=_interopDefault(require("@fortawesome/fontawesome")),faChartBar=_interopDefault(require("@fortawesome/fontawesome-free-solid/faChartBar")),faChartPie=_interopDefault(require("@fortawesome/fontawesome-free-solid/faChartPie")),faChartLine=_interopDefault(require("@fortawesome/fontawesome-free-solid/faChartLine")),faColumns=_interopDefault(require("@fortawesome/fontawesome-free-solid/faColumns")),faBraille=_interopDefault(require("@fortawesome/fontawesome-free-solid/faBraille")),faFileWord=_interopDefault(require("@fortawesome/fontawesome-free-solid/faFileWord")),d3a=require("d3-array"),d3s=require("d3-selection"),d3sc=require("d3-scale"),cloud=_interopDefault(require("d3-cloud"));function styleInject(e,t){void 0===t&&(t={});var a=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===a&&r.firstChild?r.insertBefore(l,r.firstChild):r.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}}var css='/*tbody*/\r\n.tab_vis_tbody {\r\n  cursor: pointer;\r\n}\r\n\r\n/* row & column button components set */\r\n.tab_vis_btn_container {\r\n  cursor: pointer;\r\n  position: fixed;\r\n  width: 100px;\r\n  height: 40px;\r\n  display: none;\r\n  box-shadow: 2px 2px 2px grey;\r\n}\r\n.tab_vis_btn {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #fff;\r\n  border: 1px solid #c1c1c1;\r\n  border-radius: 3px;\r\n}\r\n/* the triangle arrow */\r\n.tab_vis_btn:before,\r\n.tab_vis_btn:after {\r\n  content: " ";\r\n  width: 0;\r\n  height: 0;\r\n  position: absolute;\r\n  top: 4px;\r\n  left: -12px;\r\n  border: 6px solid transparent;\r\n  border-right-color: #fff;\r\n}\r\n.tab_vis_btn:before {\r\n  left: -13px;\r\n  border-right-color: #c1c1c1;\r\n}\r\n.tab_vis_btn div {\r\n  text-align: center;\r\n  height: 20px;\r\n  color: #777;\r\n  border-bottom: 1px solid #d3d3d3;\r\n}\r\n.tab_vis_btn div:hover {\r\n  text-align: center;\r\n  height: 20px;\r\n  background: #d3d3d3;\r\n}\r\n\r\n/*Styles for dragging*/\r\n.draggable {\r\n  cursor: move;\r\n  user-select: none;\r\n}\r\n.placeholder {\r\n  background-color: #edf2f7;\r\n  /* border: 2px dashed #cbd5e0; */\r\n}\r\n.clone-listRow {\r\n  border-top: 1px solid #ccc;\r\n}\r\n.clone-listCol {\r\n  border-left: 1px solid #ccc;\r\n  border-top: 1px solid #ccc;\r\n  display: flex;\r\n}\r\n/* .clone-table {\r\n  border-collapse: collapse;\r\n  border: none;\r\n}\r\n.clone-table th,\r\n.clone-table td {\r\n  border: 1px solid #ccc;\r\n  border-top: none;\r\n  padding: 0.5rem;\r\n} */\r\n.draggingRow {\r\n  background: #fff;\r\n  border-top: 1px solid #ccc;\r\n  z-index: 999;\r\n}\r\n.draggingCol {\r\n  background: #fff;\r\n  border-left: 1px solid #ccc;\r\n  border-top: 1px solid #ccc;\r\n  z-index: 999;\r\n}\r\n';styleInject(css);const className={addClass:function(e,t){let a=e.className,r=a+(""==a?"":" ")+t;return e.className=r,e},removeClass:function(e,t){let a=" "+e.className+" ",r=(a=a.replace(/(\s+)/gi," ")).replace(" "+t+" "," ").replace(/(^\s+)|(\s+$)/g,"");return e.className=r,e}};var css$1="\r\n@keyframes canvaKey{\r\n  0% { opacity:0; }\r\n  25% { opacity:0.3; }\r\n  50% { opacity:0.5;}\r\n  100% {opacity:1; }}\r\n@-webkit-keyframes canvasKey{\r\n  0% { opacity:0; }\r\n  25% { opacity:0.3; }\r\n  50% { opacity:0.5;}\r\n  100% {opacity:1; }}\r\n/*highlight the data cells*/\r\n@keyframes  td_highlight {\r\n   from { background: #fff;}\r\n   to { background: rgba(110,200,245,1)}\r\n}\r\n@-webkit-keyframes  td_highlight {\r\n   from { background: #fff;}\r\n   to { background: rgba(110,200,245,1)}\r\n}\r\n.tabular_container_fluid{\r\n  z-index: 50;\r\n  display:inline-block;\r\n  position:fixed;\r\n  margin:auto;\r\n  top:0;\r\n  left:0;\r\n  bottom:0;\r\n  right:0;\r\n  width:0;\r\n  height:0;\r\n  background:rgba(255,255,255,0.9);\r\n}\r\n.tabular_container_fluid .tabular_container{\r\n  margin:0px auto;\r\n  text-align: center;\r\n}\r\n.tabular_container_fluid .tabular_container canvas{\r\n    zoom:0.5;\r\n}\r\n.tabular_container_fluid #tabular_vis_btn{\r\n  margin:0px auto;\r\n  text-align: center;\r\n  height: 10%;\r\n  width: 100%;\r\n  margin-bottom:10px;\r\n  overflow: hidden;\r\n}\r\n.table_no_display{\r\n  display: none!important;\r\n}\r\n.tabular_container_fluid h3\r\n{\r\n  text-align: center;\r\n  margin: 10px auto;\r\n}\r\n.tabular_highlight{\r\n  animation: td_highlight 1s infinite reverse;\r\n  -webkit-animation: td_highlight 1s infinite reverse;\r\n\r\n}\r\n";styleInject(css$1);const insertCss=()=>{fontawesome.library.add(faChartBar),fontawesome.library.add(faChartPie),fontawesome.library.add(faChartLine),fontawesome.library.add(faColumns),fontawesome.library.add(faBraille),fontawesome.library.add(faFileWord),console.log("Insert Tabluar-vis Css done!")},canvasBase={setCanvas:function(e,t,a){return d3s.select(".tabular_container").append("canvas").attr("width",e).attr("height",t).style("animation","canvasKey 1s").style("WebkitAnimation","canvasKey 1s")},setScale:function(e,t){return d3sc.scaleLinear().range([0,e-20]).domain([0,d3a.max(t)])},setPieScale:function(e){return d3sc.scaleLinear().range([0,2*Math.PI]).domain([0,e])},maxData:function(e){return d3a.max(e)}},barStyle=e=>{let t=e.createLinearGradient(0,200,0,0);t.addColorStop(0,"rgba(110,200,245,1)"),t.addColorStop(1,"rgba(40,125,250,1)");let a=e.createLinearGradient(0,200,0,0);return a.addColorStop(0,"rgba(135,135,135,1)"),a.addColorStop(1,"rgba(0,60,60,1)"),[t,a]},drawBarLine=(e,t,a,r,l)=>(e.beginPath(),e.moveTo(t,a),e.lineTo(r,l),e.closePath(),e.stroke(),e),drawBarMark=(e,t,a,r,l,n,i)=>{let o=e.getContext("2d");o.strokeStyle="black";let d=2*parseInt(t/a);0==d&&(d=.5),o.textAlign="right";let s=0,c=l;for(o.fillText(0,0,c);s<t;){let e=s+d,t=l-n(e);o.moveTo(5,t),o.lineTo(r,t),o.strokeStyle="rgba(135,135,135,0.5)",o.stroke(),o.fillText(e,0,t,15),s+=d}return o},drawBarRect=(e,t,a,r,l,n,i,o,d,s)=>{let c=r/a.length*.8,u=r/a.length*.98;return e.font="14px Arial",a.forEach(function(a,r){e.beginPath(),e.rect(u*r+10,l-20,c,-n(a)),r==o&&void 0==s||void 0!=s&&s[r].includes(o)?(e.fillStyle=i[0],e.strokeStyle=i[0]):(e.fillStyle=i[1],e.strokeStyle=i[1]),e.fill(),e.closePath(),e.beginPath(),e.fillStyle="rgba(0,0,0,1)",e.textAlign="center",e.fillText(d[r],u*r+10+c/2,l,c),e.fillStyle="rgba(255,255,255,1)";let f=t.length>0?t[r]:a;e.fillText(f,u*r+10+c/2,l-n(a),c)}),e},drawBar=(e,t,a,r,l,n)=>{t=t.map(e=>parseFloat(e,10));let i=document.querySelector(".tabular_container");i.firstElementChild&&i.removeChild(i.firstElementChild);let o=canvasBase.setCanvas(740,740,r),d=o.node().getContext("2d"),s=canvasBase.setScale(710,t),c=canvasBase.maxData(t);d.translate(15,0),drawBarLine(d,5,720,740,720),drawBarLine(d,5,720,5,0),drawBarMark(o.node(),c,t.length,740,720,s);let u=barStyle(d);return drawBarRect(d,e,t,740,740,s,u,a,l,n),d.scale(2,2),i},bar=function(e,t,a,r,l,n){drawBar(e,t,a,r,l,n)},drawPieText=(e,t,a,r,l,n,i,o)=>{e.fillStyle="rgba(0,0,0,1)",e.font="20px Arial";let d=parseFloat(i/o),s=(d=Number(100*d).toFixed(2))+"%",c=(100-d).toFixed(2)+"%";return e.fillText(s,t,a),e.fillText(c,r,l),e},drawPieCircle=(e,t,a,r,l,n,i,o)=>{let d={x:.5*a,y:.5*r,radius:a<r?.3*a:.3*r,focusCircle:l(t[o])};e.beginPath(),e.moveTo(d.x,d.y),e.arc(d.x,d.y,d.radius,0,d.focusCircle);let s=d.focusCircle/2,c={x:d.x+d.radius*Math.cos(s),y:d.y+d.radius*Math.sin(s)};c.x=c.x<d.x?c.x-30:c.x+30,c.y=c.y<d.y?c.y-30:c.y+30,e.fillStyle=i[0],e.strokeStyle=i[0],e.closePath(),e.fill(),e.moveTo(d.x,d.y),e.lineTo(c.x,c.y),e.stroke(),e.beginPath(),e.moveTo(d.x,d.y),e.arc(d.x,d.y,d.radius,d.focusCircle,2*Math.PI);let u=(d.focusCircle+2*Math.PI)/2,f={x:d.x+d.radius*Math.cos(u),y:d.y+d.radius*Math.sin(u)};f.x=f.x<d.x?f.x-60:f.x+30,f.y=f.y<d.y?f.y-60:f.y+30,e.strokeStyle=i[1],e.fillStyle=i[1],e.closePath(),e.fill(),e.moveTo(d.x,d.y),e.lineTo(f.x,f.y),e.stroke(),drawPieText(e,c.x,c.y,f.x,f.y,0,t[o],n)},drawPieRect=(e,t,a)=>{let r=.1*a,l="except ".concat(t);return e.beginPath(),e.fillStyle="rgba(110,200,245,1)",e.rect(r,r,.5*r,.3*r),e.fillText(t,1.6*r,r+16),e.fill(),e.beginPath(),e.fillStyle="rgba(135,135,135,1)",e.rect(r,1.5*r,.5*r,.3*r),e.fillText(l,1.6*r,1.5*r+16),e.fill(),e},pieStyle=e=>{let t=e.createLinearGradient(0,200,0,0);t.addColorStop(0,"rgba(110,200,245,1)"),t.addColorStop(1,"rgba(40,125,250,1)");let a=e.createLinearGradient(0,200,0,0);return a.addColorStop(0,"rgba(135,135,135,1)"),a.addColorStop(1,"rgba(0,60,60,1)"),[t,a]},drawPie=(e,t,a,r)=>{let l=0;e=e.map(e=>{if(!isNaN(parseFloat(e,10)))return l+=parseFloat(e,10),parseFloat(e,10)});let n=document.querySelector(".tabular_container");n.firstElementChild&&n.removeChild(n.firstElementChild);let i=canvasBase.setCanvas(740,740).node().getContext("2d"),o=canvasBase.setPieScale(l);i.translate(15,0);let d=pieStyle(i);if(void 0!=r){let n;for(let e=0;e<r.length;e++)r[e].includes(t)&&(n=e);drawPieCircle(i,e,740,740,o,l,d,n),drawPieRect(i,a[n],740)}else drawPieCircle(i,e,740,740,o,l,d,t),drawPieRect(i,a[t],740);i.scale(2,2)},pie=function(e,t,a,r){drawPie(e,t,a,r)},drawLinePath=(e,t,a,r,l,n,i,o,d,s)=>{let c=r/a.length*.98;return e.font="14px Arial",e.lineWidth="4",a.forEach((r,u)=>{e.beginPath(),u!=a.length-1&&(e.moveTo(c*u+20,l-15-n(r)),e.lineTo(c*(u+1)+20,l-15-n(a[u+1])),e.strokeStyle=i[1]),e.closePath(),e.stroke(),e.beginPath(),u==o&&void 0==s||void 0!=s&&s[u].includes(o)?(e.font="22px Arial",e.fillStyle=i[0]):e.fillStyle=i[1];let f=t.length>0?t[u]:r;e.fillText(f,c*u+c/2,l-n(r)-20),e.closePath(),e.fill(),e.fillStyle=i[1],e.textAlign="center",e.font="14px Arial",e.fillText(d[u],c*u+c/2,l,c)}),e},lineStyle=()=>{return["rgba(40,125,250,1)","rgba(135,135,135,1)"]},drawLine=(e,t,a,r,l,n)=>{t=t.map(e=>parseFloat(e,10));let i=document.querySelector(".tabular_container");i.firstElementChild&&i.removeChild(i.firstElementChild);let o=canvasBase.setCanvas(740,740,r),d=o.node().getContext("2d"),s=canvasBase.setScale(710,t),c=canvasBase.maxData(t);return d.translate(15,0),drawBarLine(d,5,720,740,720),drawBarLine(d,5,720,5,0),drawBarMark(o.node(),c,t.length,740,720,s),drawLinePath(d,e,t,740,740,s,["rgba(40,125,250,1)","rgba(135,135,135,1)"],a,l,n),d.scale(2,2),d},line=(e,t,a,r,l,n)=>{drawLine(e,t,a,r,l,n)},drawBox=(e,t,a,r,l,n,i,o,d)=>{e.beginPath(),e.strokeStyle="#000000",e.fillStyle="#000000",e.font="20px Arial";let s=l-n(o.max)-10,c=l-n(o.min)-10,u=l-n(o.middle)-10,f=l-n(o.q3)-10,h=n(o.q3-o.q1);e.moveTo(.4*r,s),e.lineTo(.5*r,s),e.fillText("Max",.7*r,s),e.moveTo(.4*r,c),e.lineTo(.5*r,c),e.fillText("Min",.7*r,c),e.moveTo(.45*r,s),e.lineTo(.45*r,c),e.stroke(),e.beginPath(),e.strokeStyle="#000",e.fillStyle="#FFF",e.fillRect(.3*r,f,.3*r,h),e.strokeRect(.3*r,f,.3*r,h),e.stroke(),e.beginPath(),e.fillStyle="#000",e.moveTo(.3*r,u),e.lineTo(.6*r,u),e.fillText("Middle",.8*r,u),e.stroke(),e.beginPath(),e.strokeStyle="#108AEC",e.fillStyle="#108AEC";let p=l-n(a[i])-10;e.arc(.5*r,p,10,0,2*Math.PI),e.font="20px Arial",e.fillText(t[i],.2*r,p),e.fill()},drawBoxPlot=(e,t,a,r,l,n)=>{t=t.map(e=>parseFloat(e,10));let i=document.querySelector(".tabular_container");i.firstElementChild&&i.removeChild(i.firstElementChild);let o=canvasBase.setCanvas(740,740,l),d=o.node().getContext("2d"),s=canvasBase.setScale(710,t),c=canvasBase.maxData(t);d.translate(15,0),drawBarLine(d,5,720,5,0),drawBarMark(o.node(),c,t.length,740,720,s),drawBox(d,e,t,740,740,s,a,r),d.scale(2,2)},quickSort=e=>{if((e=e.map(e=>parseFloat(e,10))).length<=1)return e;{let t=Math.floor(e.length/2)-1,a=e.splice(t,1)[0],r=[],l=[];for(let t=0;t<e.length;t++)e[t]<a?r.push(e[t]):l.push(e[t]);return quickSort(r).concat([a],quickSort(l))}},calcPlot=function(e){let t=e;t=quickSort(t);let a,r,l,n=e.length,i=Math.floor(t.length/2);a=t.length%2!=0?t[i]:(t[i-1]+t[i])/2,l=(1+n)/4;let o=parseInt(l),d=o+1-l,s=d*t[o-1]+(1-d)*t[o];r=3*l;let c=parseInt(r),u=parseInt(r)+1-r,f=u*t[c-1]+(1-u)*t[c],h=f-s,p=s-1.5*h,m=f+1.5*h;return t[0]>p&&(p=t[0]),t[t.length-1]<m&&(m=t[t.length-1]),{min:p,max:m,middle:a,q3:f,q1:s}},boxPlot=function(e,t,a,r,l){let n=calcPlot(t);drawBoxPlot(e,t,a,n,r)},pointStyle=e=>{let t=e.createLinearGradient(0,200,0,0);t.addColorStop(0,"rgba(110,200,245,1)"),t.addColorStop(1,"rgba(40,125,250,1)");let a=e.createLinearGradient(0,200,0,0);return a.addColorStop(0,"rgba(135,135,135,1)"),a.addColorStop(1,"rgba(0,60,60,1)"),[t,a]},drawPointCol=(e,t,a,r,l,n,i,o,d,s)=>{let c=r/a.length*.05,u=r/a.length*.9;return a.forEach((a,r)=>{e.beginPath(),e.arc(u*(r+1)+c/2,l-n(a),4*c,0,2*Math.PI),e.rect(u*(r+1),l,c,-n(a)+4*c),r==o&&void 0==s||void 0!=s&&s[r].includes(o)?(e.fillStyle=i[0],e.strokeStyle=i[0]):(e.fillStyle=i[1],e.strokeStyle=i[1]),e.fill(),e.closePath(),e.beginPath(),e.fillStyle="rgba(0,0,0,1)",e.textAlign="center",e.fillText(d[r],u*(r+1)+c/2,l+20,25),e.fillStyle="rgba(255,255,255,1)";let f=t.length>0?t[r]:a;e.fillText(f,u*(r+1)+c/2,l-n(a)+c,25)}),e},drawPoint=(e,t,a,r,l,n)=>{t=t.map(e=>parseFloat(e,10));let i=document.querySelector(".tabular_container");i.firstElementChild&&i.removeChild(i.firstElementChild);let o=canvasBase.setCanvas(740,740,r),d=o.node().getContext("2d"),s=canvasBase.setScale(710,t),c=canvasBase.maxData(t);d.translate(15,0),drawBarLine(d,5,720,740,720),drawBarLine(d,5,720,5,0),drawBarMark(o.node(),c,t.length,740,720,s);let u=pointStyle(d);drawPointCol(d,e,t,740,720,s,u,a,l,n),d.scale(2,2)},point=function(e,t,a,r,l,n){drawPoint(e,t,a,r,l,n)},drawWordCloud=(e,t,a,r)=>{let l=document.querySelector(".tabular_container");l.firstElementChild&&l.removeChild(l.firstElementChild);let n=canvasBase.setScale(100,e),i=cloud().size([400,400]).words(a.map(function(a,l){return r[l].includes(t)?{text:a,size:n(e[l]),color:"rgba(40,125,250,1)"}:{text:a,size:n(e[l]),color:"#000"}})).padding(5).font("Impact").fontSize(function(e){return e.size}).on("end",function(e){d3s.select(".tabular_container").append("svg").attr("width",i.size()[0]).attr("height",i.size()[1]).append("g").attr("transform","translate("+i.size()[0]/2+","+i.size()[1]/2+")").selectAll("text").data(e).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("fill",function(e){return e.color}).style("font-family","Impact").attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+")"}).text(function(e){return e.text})});i.start()},wordCloud=(e,t,a,r)=>{drawWordCloud(e,t,a,r)},createIcon=()=>{let e=document.createElement("i");className.addClass(e,"fa fa-chart-bar");let t=document.createElement("i");className.addClass(t,"fa fa-chart-pie");let a=document.createElement("i");className.addClass(a,"fa fa-chart-line");let r=document.createElement("i");className.addClass(r,"fas fa-columns");let l=document.createElement("i");className.addClass(l,"fas fa-braille");let n=document.createElement("i");return className.addClass(n,"fas fa-file-word"),[e,t,a,r,l,n]},createDrawButton=e=>{let t=e.data,a=document.createElement("div");a.setAttribute("id","tabular_vis_btn");let r=createIcon(),l=document.createElement("button");l.appendChild(r[0]),l.addEventListener("click",()=>{let e=[t.oriData,t.data,t.index,t.status,t.title,t.titleIdx];bar(...e)}),a.appendChild(l);let n=document.createElement("button"),i=document.createElement("i");className.addClass(i,"fa fa-chart-pie"),n.appendChild(r[1]),n.addEventListener("click",()=>{let e=[t.data,t.index,t.title,t.titleIdx];pie(...e)}),a.appendChild(n);let o=document.createElement("button");className.addClass(o,"numerical"),o.appendChild(r[2]),o.addEventListener("click",()=>{let e=[t.oriData,t.data,t.index,t.status,t.title,t.titleIdx];line(...e)}),a.appendChild(o);let d=document.createElement("button");className.addClass(d,"numerical"),d.appendChild(r[3]),d.addEventListener("click",()=>{let e=[t.oriData,t.data,t.index,t.status,t.title];boxPlot(...e)}),a.appendChild(d);let s=document.createElement("button");s.appendChild(r[4]),className.addClass(s,"numerical"),s.addEventListener("click",()=>{let e=[t.oriData,t.data,t.index,t.status,t.title,t.titleIdx];point(...e)}),a.appendChild(s);let c=document.createElement("button");return className.addClass(c,"cate"),c.appendChild(r[5]),c.addEventListener("click",()=>{let e=[t.data,t.index,t.title,t.titleIdx];wordCloud(...e)}),a.appendChild(c),a},createTableVisContainer=e=>{let t=document.createElement("div");className.addClass(t,"tabular_container_fluid");let a=document.createElement("div");return a.setAttribute("id","tabular_vis"),className.addClass(a,"tabular_container"),a.addEventListener("click",()=>{t.removeAttribute("style"),t.style.width="0",t.removeChild(t.querySelector("h3")),a.removeChild(a.firstElementChild),document.querySelectorAll(".tabular_highlight").forEach(e=>{className.removeClass(e,"tabular_highlight")})}),t.appendChild(createDrawButton(e)),t.appendChild(a),document.body.appendChild(t),console.log("Create Tabular div done"),t},swapTableVis=(e,t)=>{let a=t.querySelector(".tabular_container");return e?"0px"!=t.style.width?(t.removeAttribute("style"),t.style.width="0",t.removeChild(t.firstElementChild),!1):(t.style.width="400px",t.style.height="500px",t.style.animation="tabular 1s",t.style.WebkitAnimation="tabular 1s",t.style.cursor="pointer",!0):(a.firstElementChild&&a.removeChild(a.firstElementChild),t.style.width="400px",t.style.height="500px",t.style.animation="tabular 1s",t.style.WebkitAnimation="tabular 1s",t.style.cursor="pointer",!0)},numericalData=(e,t,a,r)=>{for(let l=0;l<e[0].length;){let n=e[0][l].innerHTML,i=n.replace(/\,|\%/g,"");if(/^\d+\/\d+$/.test(i)){let e=i.split("/");i=e[0]/e[0]}r.push(n),t.push(i),a.push(e[1][l]),l++}return{oriData:r,data:t,title:a}},cateData=(e,t,a,r)=>{let l=[];for(let r=0;r<e.length;r++){let n=e[r].innerHTML;if(a.includes(n)){let e=a.indexOf(n);l[e].push(r),t[e]++}else t.push(1),a.push(n),l.push([r])}return{oriData:r,data:t,title:a,titleIdx:l}},regData=(e,t)=>{let a=[],r=[],l=[],n=e[0][0].innerHTML.replace(/\,/g,"");return t&&e[0].forEach(e=>{className.addClass(e,"tabular_highlight")}),/^\d+\.?\d*$/.test(n)||/^\d+\.?\d+\%$/.test(n)||/^\d+\/\d+$/.test(n)?numericalData(e,a,r,l):cateData(e[0],a,r,l)},colData=function(e,t,a){let r=e.parentNode,l=r.parentNode.children,n=[],i=Array.prototype.indexOf.call(r.children,e);for(let e=0;e<l.length;e++)n.push(l[e].children[i]);let o=regData([n,t],a),d={data:o.data,oriData:o.oriData,title:o.title,index:Array.prototype.indexOf.call(n,e)};return"titleIdx"in o&&Object.assign(d,{titleIdx:o.titleIdx}),d},rowData=function(e,t,a){let r=e.parentNode,l=Array.from(r.children);l.shift();let n=regData([l,t],a),i={data:n.data,title:n.title,oriData:n.oriData,index:Array.prototype.indexOf.call(l,e)};return"titleIdx"in n&&Object.assign(i,{titleIdx:n.titleIdx}),i},initHead=(e,t)=>{if(e.querySelector("h3"))return e.querySelector("h3").innerHTML=t,e.querySelector("h3");{let e=document.createElement("h3");return e.innerHTML=t,e}},initBtn=(e,t)=>{let a=document.createElement("div"),r=document.createElement("div");className.addClass(a,"tab_vis_btn_container"),className.addClass(r,"tab_vis_btn");let l=document.createElement("div"),n=document.createElement("div");l.innerHTML="ROW",n.innerHTML="COL";return r.appendChild(l),r.appendChild(n),a.appendChild(r),document.body.appendChild(a),l.addEventListener("click",()=>{document.querySelectorAll(".tabular_highlight").forEach(function(e){className.removeClass(e,"tabular_highlight")}),a.style.display="none";let r=rowData(e.ele,e.rowTitle,1),l=colData(e.ele,e.colTitle,0).index;Object.assign(e.data,{data:r.data,title:r.title,index:r.index,oriData:r.oriData,head:e.colTitle[l],status:"row"}),"titleIdx"in r?Object.assign(e.data,{titleIdx:r.titleIdx}):"titleIdx"in e.data&&delete e.data.titleIdx,t.insertBefore(initHead(t,e.data.head),t.querySelector(".tabular_container")),document.querySelectorAll(".table_no_display").forEach(e=>className.removeClass(e,"table_no_display")),r.oriData.length>0?document.querySelectorAll(".cate").forEach(e=>className.addClass(e,"table_no_display")):document.querySelectorAll(".numerical").forEach(e=>className.addClass(e,"table_no_display")),swapTableVis(!1,t),bar(r.oriData,r.data,r.index,"row",r.title,r.titleIdx)}),n.addEventListener("click",()=>{document.querySelectorAll(".tabular_highlight").forEach(e=>{className.removeClass(e,"tabular_highlight")}),a.style.display="none";let r=colData(e.ele,e.colTitle,1),l=rowData(e.ele,e.rowTitle,0).index;Object.assign(e.data,{data:r.data,title:r.title,index:r.index,oriData:r.oriData,head:e.rowTitle[l],status:"col"}),"titleIdx"in r?Object.assign(e.data,{titleIdx:r.titleIdx}):"titleIdx"in e.data&&delete e.data.titleIdx,t.insertBefore(initHead(t,e.data.head),t.querySelector(".tabular_container")),document.querySelectorAll(".table_no_display").forEach(e=>className.removeClass(e,"table_no_display")),r.oriData.length>0?document.querySelectorAll(".cate").forEach(e=>className.addClass(e,"table_no_display")):document.querySelectorAll(".numerical").forEach(e=>className.addClass(e,"table_no_display")),swapTableVis(!1,t),swapTableVis(!1,t),bar(r.oriData,r.data,r.index,"col",r.title,r.titleIdx)}),a},colTitle=e=>{let t=e.querySelector("tbody"),a=[];return Array.from(t.children).forEach(e=>{for(;e.children[0];)e=e.children[0];a.push(e.innerHTML)}),a},rowTitle=e=>{let t=e.querySelector("thead").querySelector("tr"),a=Array.from(t.children),r=[];return Array.prototype.shift.call(a),a.forEach(e=>{for(;e.children[0];)e=e.children[0];r.push(e.innerHTML)}),r},initRowDragger=(e,t,a,r)=>{let l,n,i,o,d=!1,s=0,c=0;const u=function(e,t){const a=e.parentNode,r=e.nextSibling===t?e:e.nextSibling;t.parentNode.insertBefore(e,t),a.insertBefore(t,r)},f=function(e,t){const a=e.getBoundingClientRect(),r=t.getBoundingClientRect();return a.top+a.height/2<r.top+r.height/2},h=function(l){t.style.display="none",r.lastChild.click(),a.tableChanged=!0;const i=l.target.parentNode;n=[].slice.call(e.querySelectorAll("tr")).indexOf(i),s=l.clientX,c=l.clientY,document.addEventListener("mousemove",p),document.addEventListener("mouseup",m)},p=function(t){d||(d=!0,function(){const t=e.getBoundingClientRect(),a=parseInt(window.getComputedStyle(e).width);(o=document.createElement("div")).classList.add("clone-listRow"),o.style.position="absolute",o.style.left=`${t.left}px`,o.style.top=`${t.top}px`,e.parentNode.insertBefore(o,e),e.style.visibility="hidden",e.querySelectorAll("tr").forEach(function(e){const t=document.createElement("div");t.classList.add("draggable");const r=document.createElement("table");r.style.width=`${a}px`;const l=document.createElement("tr");[].slice.call(e.children).forEach(function(e){const t=e.cloneNode(!0);t.style.width=`${parseInt(window.getComputedStyle(e).width)}px`,l.appendChild(t)}),r.appendChild(l),t.appendChild(r),o.appendChild(t)})}(),(l=[].slice.call(o.children)[n]).classList.add("draggingRow"),(i=document.createElement("div")).classList.add("placeholder"),l.parentNode.insertBefore(i,l.nextSibling),i.style.height=`${l.offsetHeight}px`),l.style.position="absolute",l.style.top=`${l.offsetTop+t.clientY-c}px`,l.style.left=`${l.offsetLeft+t.clientX-s}px`,s=t.clientX,c=t.clientY;const a=l.previousElementSibling,r=i.nextElementSibling;if(a&&a.previousElementSibling&&f(l,a))return u(i,l),void u(i,a);r&&f(r,l)&&(u(r,i),u(r,l))},m=function(){i&&i.parentNode.removeChild(i),l.classList.remove("dragging"),l.style.removeProperty("top"),l.style.removeProperty("left"),l.style.removeProperty("position");const t=[].slice.call(o.children).indexOf(l);d=!1,o.parentNode.removeChild(o);let a=[].slice.call(e.querySelectorAll("tr"));n>t?a[t].parentNode.insertBefore(a[n],a[t]):a[t].parentNode.insertBefore(a[n],a[t].nextSibling),e.style.removeProperty("visibility"),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",m)};e.querySelectorAll("tr").forEach(function(e,t){if(0===t)return;const a=e.firstElementChild;a.classList.add("draggable"),a.addEventListener("mousedown",h)})},initColDragger=(e,t,a,r)=>{let l,n,i,o,d=!1,s=0,c=0;const u=function(e,t){const a=e.parentNode,r=e.nextSibling===t?e:e.nextSibling;t.parentNode.insertBefore(e,t),a.insertBefore(t,r)},f=function(e,t){const a=e.getBoundingClientRect(),r=t.getBoundingClientRect();return a.left+a.width/2<r.left+r.width/2},h=function(l){t.style.display="none",r.lastChild.click(),a.tableChanged=!0,n=[].slice.call(e.querySelectorAll("th")).indexOf(l.target),s=l.clientX-l.target.offsetLeft,c=l.clientY-l.target.offsetTop,document.addEventListener("mousemove",p),document.addEventListener("mouseup",m)},p=function(t){d||(d=!0,function(){const t=e.getBoundingClientRect();(o=document.createElement("div")).classList.add("clone-listCol"),o.style.position="absolute",o.style.left=`${t.left}px`,o.style.top=`${t.top}px`,e.parentNode.insertBefore(o,e),e.style.visibility="hidden";const a=[].slice.call(e.querySelectorAll("tbody td")),r=[].slice.call(e.querySelectorAll("th")),l=r.length;r.forEach(function(e,t){const r=parseInt(window.getComputedStyle(e).width),n=document.createElement("div");n.classList.add("draggable");const i=document.createElement("table");i.setAttribute("class","clone-table"),i.style.width=`${r}px`;const d=e.cloneNode(!0);let s=document.createElement("tr");s.appendChild(d),i.appendChild(s),a.filter(function(e,a){return(a-t)%l==0}).forEach(function(e){const t=e.cloneNode(!0);t.style.width=`${r}px`,(s=document.createElement("tr")).appendChild(t),i.appendChild(s)}),n.appendChild(i),o.appendChild(n)})}(),(l=[].slice.call(o.children)[n]).classList.add("draggingCol"),(i=document.createElement("div")).classList.add("placeholder"),l.parentNode.insertBefore(i,l.nextSibling),i.style.width=`${l.offsetWidth}px`),l.style.position="absolute",l.style.top=`${l.offsetTop+t.clientY-c}px`,l.style.left=`${l.offsetLeft+t.clientX-s}px`,s=t.clientX,c=t.clientY;const a=l.previousElementSibling,r=i.nextElementSibling;if(a&&f(l,a))return u(i,l),void u(i,a);r&&f(r,l)&&(u(r,i),u(r,l))},m=function(){i&&i.parentNode.removeChild(i),l.classList.remove("dragging"),l.style.removeProperty("top"),l.style.removeProperty("left"),l.style.removeProperty("position");const t=[].slice.call(o.children).indexOf(l);d=!1,o.parentNode.removeChild(o),e.querySelectorAll("tr").forEach(function(e){const a=[].slice.call(e.querySelectorAll("th, td"));n>t?a[t].parentNode.insertBefore(a[n],a[t]):a[t].parentNode.insertBefore(a[n],a[t].nextSibling)}),e.style.removeProperty("visibility"),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",m)};e.querySelectorAll("th").forEach(function(e){e.classList.add("draggable"),e.addEventListener("mousedown",h)})},tableElement="[object HTMLTableElement]",initTableVis=function(e){if(Object.prototype.toString.call(e)==tableElement){let t,a=e.getElementsByTagName("tbody")[0],r=new Object;this.initial?t=document.querySelector(".tabular_container_fluid"):(Object.assign(r,{data:{},rowTitle:rowTitle(e),colTitle:colTitle(e),tableChanged:!1}),fontawesome.library.add(faChartBar),fontawesome.library.add(faChartPie),fontawesome.library.add(faChartLine),fontawesome.library.add(faColumns),fontawesome.library.add(faBraille),fontawesome.library.add(faFileWord),console.log("Insert Tabluar-vis Css done!"),t=createTableVisContainer(r),this.initial=!0);let l=initBtn(r,t);initRowDragger(e,l,r,t),initColDragger(e,l,r,t),className.addClass(a,"tab_vis_tbody"),a.addEventListener("click",t=>{let a=t||window.event,n=a.clientX,i=a.clientY;l.style.left=n+"px",l.style.top=i+"px",l.style.display="block",r.ele=a.target,r.tableChanged&&(r.rowTitle=rowTitle(e),r.colTitle=colTitle(e),r.tableChanged=!1)})}else console.error("Please ensure the table element is use")},table_vis={initial:!1,vis:initTableVis};module.exports=table_vis;
